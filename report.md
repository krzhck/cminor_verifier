# 软件分析与验证 实验报告

**周雨豪  2018013399  软件92**



## 1 实验环境

**操作系统：**macOS 12.2

**内存：**8GB

**平台：**.NET 6.0.301



## 2 实验目标

- 对于给定的带有部分正确性验证标注的输入程序源码，能够返回其部分正确性验证的结果。
- 对于给定的带有部分正确性验证标注和秩函数的输入程序源码，能够返回其完全正确性验证的结果。



## 3 实现过程

#### 3.1 基本路径

`Verifier` 的输入 cfg 包含三种特殊节点

算法主体在 `VCAlgo` 中实现，对于输入，若包含秩函数，则检查秩函数的非负性，将不满足非负性的输入返回UNVERIFIED。根据基本路径的定义：

- 开始于过程入口或循环头，终止于循环头、断言或过程出口
- 分支语句分情况讨论
- 不含循环

根据对 cfg 结构的分析可知任何一条首尾均为特殊节点且经过特殊节点不超过 2 个的 path 都符合基本路径定义。因此在节点列表中采用宽度优先搜索找出所有满足要求的路径，调用 `VerifyWLP` 生成并验证路径的最弱前置条件，由此完成部分正确性验证。接着对于有秩函数的 cfg，调用 `VerifyRankFunc` 验证终止性。

#### 3.2 验证 wlp

根据最弱前置条件的生成规则，对一个给定的语句序列，可以从后向前递归地生成对应于整条路径的 wlp，因此生成路径 wlp 的函数`PathWLP` 通过调用生成块 wlp 的函数 `BlockWLP`，后者再调用生成单条语句 wlp 的函数 `StmtWLP` 由后向前地生成最弱前置条件，喂给 SMT solver 求解验证结果。

#### 3.3 验证秩函数

对包含秩函数的输入还需验证程序终止性，该部分的实现在函数 `VerifyRankFunc` 内，对于循环产生的链，逐 statement 计算 wlp；而对不包含函数调用的路径直接返回 true。



## 4 实验结果

部分正确性得分 16.80；完全正确性得分 2.40。



## 5 问题 & 解决

- 初次尝试运行 dotnet 时遇到了无法加载 Z3 的问题，之后发现是项目不兼容于 ARM 架构处理器的缘故，故换用 x86 架构的处理器开发。
- 在部分正确性验证的过程中，路径中可能会包含的 statement 种类非常多，对于每种类型都需要特殊的分类处理，该过程（尤其涉及到过程调用）比较复杂。
- 初始接触项目时，对于封装好的类，如 Expression、Statement 等缺乏系统的了解，导致不知从何下手。不过考虑到项目不涉及这些类内部代码的改动，因此先专注于算法本身过程的设计，当遇到类方法调用的需要再去阅读相应源码。